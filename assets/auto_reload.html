<!-- Auto reload page helper. -->
<script type="text/javascript">
	(function () {
		var es = new EventSource('/nobone-sse/auto_reload');

		es.addEventListener('error', function (e) {
			console.warn(e.message);
		});

		es.addEventListener('file_modified', function (e) {
			var msg = JSON.parse(e.data);

			console.log(">> file_modified: " + msg.path);

			var reload_elem = function (el) {
				el.outerHTML = el.outerHTML;
			};

			each = function (qs, handler) {
				elems = document.querySelectorAll(qs);
				[].slice.apply(elems).forEach(handler);
			}

			switch (msg.ext_bin) {
				case '.css':
					each('link[href*="' + msg.req_path + '"]', reload_elem);
					break;

				case '.jpg':
				case '.gif':
				case '.png':
					each('img[src*="' + msg.req_path + '"]', reload_elem);

				default:
					location.reload();
			}
		});
	})();
</script>
